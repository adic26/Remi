<?xml version="1.0" encoding="utf-8" ?>
<Instruments xmlns="TsdLib.Instruments.xsd">
  <Instrument Name="BlackBerry_BCM4334" ConnectionType="Telnet" CommandDelay="200" Interfaces="IBlackBerryWlan" InitCommands="echo fw_pltenable::1>>/pps/services/wifi/escreen">
    
    <!--Discovery-->
    <IdQuery Response="BlackBerry Device"/>
    
    <!--Identification-->
    <ModelNumber Message="cat /pps/services/hw_info/inventory" RegEx="(?&lt;=Board_Type::).*(?=\r\nBoot_Devices)"/>
    <SerialNumber Message="cat /pps/system/nvram/deviceinfo" RegEx="(?&lt;=BSN::).*(?=\r\nBTMAC)"/>
    <FirmwareVersion Message="cat /pps/services/deviceproperties" RegEx="(?&lt;=scmbundle::).*(?=\r\nscmbundle0)"/>

    <!--For 4339 <Command Name="DisableWatchdog" Message="wl_bcm4334 phy_watchdog 0" />-->

    <Command Name="SetCountryCode" Message="wl_bcm4334 country {0}">
      <Parameter Name="countryCode" Type="String"/>
    </Command>
    <Command Name="SetBand" Message="wl_bcm4334 band {0}">
      <Parameter Name="band" Type="String"/>
    </Command>
    <Command Name="SetChannel" Message="wl_bcm4334 channel {0}">
      <Parameter Name="channel" Type="Int32"/>
    </Command>
    <Command Name="SetFrequency" Message="wl_bcm4334 band {0};wl_bcm4334 channel {1}" >
      <Parameter Name="band" Type="String"/>
      <Parameter Name="channel" Type="Int32"/>
    </Command>
    <Command Name="SetRateMbps" Message="wl_bcm4334 rate {0}">
      <Parameter Name="rate" Type="Double"/>
    </Command>
    <Command Name="SetRateMCS" Message="wl_bcm4334 nrate -m {0}">
      <Parameter Name="rate" Type="Double"/>
    </Command>
    <Command Name="SetUplinkPowerDefault" Message="wl_bcm4334 txpwr1 -1">
    </Command>
    <Command Name="SetUplinkPowerTarget" Message="wl_bcm4334 txpwr1 -d {0}">
      <Parameter Name="powerLevel" Type="Double"/>
    </Command>
    <Command Name="SetUplinkPowerTargetOverwriteFirmware" Message="wl_bcm4334 txpwr1 -o -d {0}">
      <Parameter Name="powerLevel" Type="Double"/>
    </Command>
    <Command Name="SetPowerIndex" Message="wl_bcm4334 phy_txprwindex {0}">
      <Parameter Name="powerIndex" Type="Int32"/>
    </Command>
    <Command Name="StartTx" Message="wl_bcm4334 pkteng_start 00:11:22:33:44:55 tx 1000 1024 0">
    </Command>
    <Command Name="StartRx" Message="wl_bcm4334 pkteng_start 00:00:00:C0:FF:EE rxwithack">
    </Command>
    <Command Name="ResetCounter" Message="wl_bcm4334 reset_cnts">
    </Command>

    <Query Name="GetImei" Message="cat /pps/system/nvram/deviceinfo" RegEx="(?&lt;=IMEI::).*(?=\r\nInProduction)" ReturnType="String">
    </Query>
    <Query Name="GetBcmFirmwareType" Message="wl_bcm4334 ver" RegEx="(?&lt;=version (\d+\.){3}\d+ \().*(?=\))" ReturnType="String">
    </Query>
    <Query Name="GetBcmFirmwareVersion" Message="wl_bcm4334 ver" RegEx="(?&lt;=version )(\d+\.){3}\d+" ReturnType="String">
    </Query>
    <Query Name="GetCountryCode" Message="wl_bcm4334 country" ReturnType="String">
    </Query>
    <Query Name="InitializeWlanRx" Message="wl_bcm4334 pkteng_stop rx;wl_bcm4334 mpc 0;wl_bcm4334 up;wl_bcm4334 isup" ReturnType="Boolean">
    </Query>
    <Query Name="InitializeWlanTx" Message="wl_bcm4334 pkteng_stop tx;wl_bcm4334 down;wl_bcm4334 mpc 0;wl_bcm4334 up;wl_bcm4334 isup" ReturnType="Boolean">
    </Query>
    <Query Name="IsEnabled" Message="wl_bcm4334 isup" ReturnType="Int32">
    </Query>
    <Query Name="GetRxFrameCount" Message="wl_bcm4334 counters" RegEx="(?&lt;=rxdfrmmcast )\d+" ReturnType="Int32">
    </Query>
    <Query Name="GetPowerIndex" Message="wl_bcm4334 phy_txprwindex" ReturnType="Int32">
    </Query>

  </Instrument>
</Instruments>